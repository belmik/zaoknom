{% extends 'docbox/base.html' %}
{% load docbox_price %}

{% block tab_title %}
Заказ: {{ object.provider_code }}
{% endblock tab_title %}

{% block page_header %}
Заказ: {{ object.provider_code }}
<a class="text-reset" style="font-size:1.2rem;" href="{{ object.get_absolute_edit_url }}">
  <span class="fas fa-pen fa-fw"></span>
</a>
{% endblock page_header %}

{% block content %}
<dl class="row">
    <dt class="col-sm-2  offset-sm-3">Создан:</dt>
    <dd class="col-sm-4">{{ object.date_created|date:'d.m.y' }}</dd>

    <dt class="col-sm-2  offset-sm-3">Статус:</dt>
    <dd class="col-sm-4">{{ object.get_status_display }}</dd>

    <dt class="col-sm-2  offset-sm-3">Заказчик:</dt>
    <dd class="col-sm-4">
        <a href="{% url 'docbox:client-detail' object.client.pk %}" class="text-reset">
        {{ object.client.name }}
        </a>    
    </dd>    

    
    {% if object.date_delivery %}
        <dt class="col-sm-2  offset-sm-3">Доставка:</dt>
        <dd class="col-sm-4">{{ object.date_delivery|date:'d.m.y' }}</dd>
    {% endif %}

    {% if object.date_mounting %}
        <dt class="col-sm-2  offset-sm-3">Монтаж:</dt>
        <dd class="col-sm-4">{{ object.date_mounting|date:'d.m.y' }}</dd>
    {% endif %}

    {% if object.date_finished %}
        <dt class="col-sm-2  offset-sm-3">Закрыт:</dt>
        <dd class="col-sm-4">{{ object.date_finished|date:'d.m.y' }}</dd>
    {% endif %}

    {% if object.address %}
        <dt class="col-sm-2  offset-sm-3">Адрес:</dt>
        <dd class="col-sm-4">{{ object.address }}</dd>
    {% endif %}

    {% if object.mounter %}
        <dt class="col-sm-2  offset-sm-3">Монтаж:</dt>
        <dd class="col-sm-4">{{ object.mounter }} [{{ object.price.mounting|price }}]</dd>
    {% endif %}

    {% if object.price %}
        {% if object.price.mounting %}
            <dt class="col-sm-2  offset-sm-3">Cумма с монтажем:</dt>
        {% else %}
            <dt class="col-sm-2  offset-sm-3">Cумма:</dt>
        {% endif %}
        <dd class="col-sm-4">{{ object.price.total|price }}</dd>
    {% endif %}

    {% if object.remaining > 0 %}
        <dt class="col-sm-2  offset-sm-3">Текущий остаток:</dt>
        <dd class="col-sm-4">{{ object.remaining|price }}</dd>
    {% endif %}

    {% if object.comment %}
        <dt class="col-sm-2  offset-sm-3">Комментарий:</dt>
        <dd class="col-sm-4">{{ object.comment }}</dd>
    {% endif %}

</dl>
<div class="row">
<div class="col-sm-6 offset-sm-3">
  <h5 class="mt-5">Последние платежи:</h5>
    <table class="table table-striped table-borderless">
        <thead>
            <tr>
                <th scope="col" style="width: 100px;">Дата</th>
                <th scope="col" class="text-right" style="width: 150px;">Сумма</th>
                <th scope="col">Комментарий</th>
                <th scope="col">Действия</th>
            </tr>
        </thead>
        <tbody>
        {% for transaction in object.transactions %}
        <tr>
            <td>{{ transaction.date|date:'d.m.y' }}</td>
            <td class="text-right text-nowrap">
                <a class="text-reset" href="{% url 'docbox:edit-transaction' transaction.pk %}">
                    {{ transaction.amount|price }}
                </a>
            </td>
            <td>{{ transaction.comment }}</td>
            <td>
                <a class="text-reset" href="{% url 'docbox:delete-transaction' transaction.pk %}?next={{ request.path }}">
                <span class="fas fa-times fa-fw"></span>
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</div>
{% endblock content %}