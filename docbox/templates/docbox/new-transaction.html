{% extends 'docbox/base.html' %}

{% block page_header %}
Создание новой транзакции
{% endblock page_header %}


{% block content %}
<div class="container" style="max-width: 350px;">
<form method="post">
    {% csrf_token %}
    <input type="hidden" name="next" value="{% url 'docbox:transactions-list' %}">
    <div class="form-row">
        <div class="form-group col mb-3">
            <div class="custom-control custom-switch">
            {% include "docbox/form/field.html" with field=form.cashbox  %}
            <label class="custom-control-label" for="id_cashbox">Касса</label>
            </div>
        </div>
    </div>
    <div class="form-row">
        <div class="input-group col mb-3">
            {% include "docbox/form/field.html" with field=form.amount prepend="Сумма:" append="грн." %}
        </div>
    </div>
    <div class="form-row">
        <div class="typeahead__container form-group col">
            <div class="typeahead__query ">
                {% include "docbox/form/field.html" with field=form.client %}
                <input type="text" name="client_select" class="clients-typeahead form-control" autocomplete="off" placeholder="Клиент" id="id_client_select">
            </div>
        </div>
    </div>
    <div class="form-row">
        <div class="typeahead__container form-group col">
            <div class="typeahead__query ">
                {% include "docbox/form/field.html" with field=form.order %}
                <input type="text" name="order_select" class="orders-typeahead form-control" autocomplete="off" placeholder="Заказ" id="id_order_select">
            </div>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group date-group col">
            {% include "docbox/form/field.html" with field=form.date %}
        </div>
    </div>
    <div class="form-row">
        <div class="form-group col">
            {% include "docbox/form/field.html" with field=form.comment %}
        </div>
    </div>
    <div class="form-row text-center">
        <input type="submit" class="form-control btn btn-outline-secondary" value="Создать">
    </div>
</form>
</div>
{% endblock content %}

{% block scripts %}
<script>
$.typeahead({
    input: ".orders-typeahead",
    order: "asc",
    minLength: 0,
    searchOnFocus: true,
    templateValue: '{% templatetag openvariable %}display{% templatetag closevariable %}',
    source: {
        data: [
        {% for order in orders_list %}{
            display: '{{ order.provider_code }} - {{ order.client.name }} (остаток: {{ order.remaining }} грн.)',
            order_id: '{{ order.order_id }}',
            client_name: '{{ order.client.name }}',
            client_id: '{{ order.client.client_id }}',
        },{% endfor %}
        ]
    },
    callback: {
        onClickAfter: function(node, a, item, event){
            $("#id_order").val(item.order_id);
            $("#id_client").val(item.client_id);
            $(".clients-typeahead").val(item.client_name);
        },
        onCancel: function(node, event){
            $("#id_order").val("");
        },
    }
    
});
$.typeahead({
    input: ".clients-typeahead",
    order: "asc",
    minLength: 0,
    searchOnFocus: true,
    templateValue: '{% templatetag openvariable %}name{% templatetag closevariable %}',
    source: {
        data: [
        {% for client in clients_list %}{
            display: '{{ client }}',
            name: '{{ client.name }}',
            client_id: '{{ client.client_id }}',
        },{% endfor %}
        ]
    },
    callback: {
        onClickAfter: function(node, a, item, event){
            $("#id_client").val(item.client_id);
        },
        onCancel: function(node, event){
            $("#id_client").val("");
        },
    }
    
});
</script>
{% endblock scripts %}